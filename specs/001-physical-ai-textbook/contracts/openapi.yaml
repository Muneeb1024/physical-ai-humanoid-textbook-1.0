openapi: 3.0.3
info:
  title: Physical AI & Humanoid Robotics Textbook API
  description: API for the Physical AI & Humanoid Robotics textbook platform with personalized learning, RAG chatbot, and assessment features
  version: 1.0.0
  contact:
    name: Development Team
    email: dev@physical-ai-textbook.example.com

servers:
  - url: https://api.physical-ai-textbook.com
    description: Production server
  - url: https://staging-api.physical-ai-textbook.com
    description: Staging server
  - url: http://localhost:8000
    description: Development server

paths:
  /auth/register:
    post:
      summary: Register a new student
      description: Creates a new student account with background assessment
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudentRegistration'
      responses:
        '201':
          description: Student successfully registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'

  /auth/login:
    post:
      summary: Student login
      description: Authenticates a student and returns access token
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudentLogin'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/assessment:
    post:
      summary: Submit background assessment
      description: Submits the initial background assessment to determine expertise level
      tags:
        - Authentication
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BackgroundAssessment'
      responses:
        '200':
          description: Assessment submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssessmentResult'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /content/modules:
    get:
      summary: List all modules
      description: Returns a list of all curriculum modules
      tags:
        - Content
      security:
        - BearerAuth: []
      parameters:
        - name: language
          in: query
          required: false
          schema:
            type: string
            default: 'en'
            enum: [en, ur]
      responses:
        '200':
          description: List of modules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Module'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /content/modules/{module_id}:
    get:
      summary: Get specific module
      description: Returns details for a specific module
      tags:
        - Content
      security:
        - BearerAuth: []
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Module details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModuleDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /content/progress/{student_id}:
    get:
      summary: Get user progress
      description: Returns the progress of a specific student
      tags:
        - Content
      security:
        - BearerAuth: []
      parameters:
        - name: student_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Student progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudentProgress'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /chatbot/query:
    post:
      summary: Submit question to chatbot
      description: Sends a question to the RAG chatbot and returns an answer
      tags:
        - Chatbot
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatbotQuery'
      responses:
        '200':
          description: Chatbot response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatbotResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /chatbot/history/{student_id}:
    get:
      summary: Get conversation history
      description: Returns the chat history for a specific student
      tags:
        - Chatbot
      security:
        - BearerAuth: []
      parameters:
        - name: student_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Chat history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChatbotQueryResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /assessments/{module_id}:
    get:
      summary: Get assessments for module
      description: Returns all assessments for a specific module
      tags:
        - Assessments
      security:
        - BearerAuth: []
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of assessments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Assessment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /assessments/submit:
    post:
      summary: Submit assessment answers
      description: Submits answers for an assessment and returns results
      tags:
        - Assessments
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssessmentSubmission'
      responses:
        '200':
          description: Assessment submitted and graded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssessmentResult'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /assessments/results/{student_id}:
    get:
      summary: Get assessment results
      description: Returns assessment results for a specific student
      tags:
        - Assessments
      security:
        - BearerAuth: []
      parameters:
        - name: student_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Assessment results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AssessmentResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  schemas:
    StudentRegistration:
      type: object
      required:
        - email
        - password
        - background_assessment
      properties:
        email:
          type: string
          format: email
          description: Student's email address
        password:
          type: string
          format: password
          description: Student's password
        background_assessment:
          type: object
          description: Initial questionnaire responses
          properties:
            expertise_level:
              type: string
              enum: [beginner, intermediate, advanced]
            experience_years:
              type: integer
              minimum: 0
            primary_interest:
              type: string
              description: Student's primary interest in robotics

    StudentLogin:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password

    StudentResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        expertise_level:
          type: string
          enum: [beginner, intermediate, advanced]
        language_preference:
          type: string
          default: 'en'
        created_at:
          type: string
          format: date-time

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string
          default: 'bearer'
        student:
          $ref: '#/components/schemas/StudentResponse'

    BackgroundAssessment:
      type: object
      required:
        - expertise_level
        - experience_years
        - primary_interest
      properties:
        expertise_level:
          type: string
          enum: [beginner, intermediate, advanced]
        experience_years:
          type: integer
          minimum: 0
        primary_interest:
          type: string
        robotics_experience:
          type: string
        programming_experience:
          type: string

    AssessmentResult:
      type: object
      properties:
        expertise_level:
          type: string
          enum: [beginner, intermediate, advanced]
        recommendations:
          type: array
          items:
            type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1

    Module:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        module_number:
          type: integer
        duration_weeks:
          type: integer
        learning_objectives:
          type: array
          items:
            type: string
        content_path:
          type: string

    ModuleDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        module_number:
          type: integer
        duration_weeks:
          type: integer
        learning_objectives:
          type: array
          items:
            type: string
        content_path:
          type: string
        prerequisites:
          type: array
          items:
            type: string
            format: uuid
        interactive_elements:
          type: array
          items:
            $ref: '#/components/schemas/InteractiveElement'
        assessments:
          type: array
          items:
            $ref: '#/components/schemas/Assessment'

    InteractiveElement:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [simulator, 3d_model, code_example]
        title:
          type: string
        content:
          type: string
        parameters:
          type: object

    StudentProgress:
      type: object
      properties:
        student_id:
          type: string
          format: uuid
        modules_completed:
          type: array
          items:
            type: string
            format: uuid
        current_module:
          type: string
          format: uuid
        assessment_scores:
          type: array
          items:
            $ref: '#/components/schemas/AssessmentResult'
        overall_progress:
          type: number
          minimum: 0
          maximum: 100

    ChatbotQuery:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: The question asked by the student
        context_module_id:
          type: string
          format: uuid
          description: Optional module ID for context

    ChatbotResponse:
      type: object
      properties:
        response:
          type: string
          description: The chatbot's answer
        sources:
          type: array
          items:
            type: string
          description: List of content sources used in the response
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: Confidence level of the response

    ChatbotQueryResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        query:
          type: string
        response:
          type: string
        timestamp:
          type: string
          format: date-time
        context_used:
          type: object

    Assessment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        assessment_type:
          type: string
          enum: [quiz, exercise, project]
        questions:
          type: array
          items:
            type: object
        passing_score:
          type: integer
          minimum: 0
          maximum: 100

    AssessmentSubmission:
      type: object
      required:
        - assessment_id
        - answers
      properties:
        assessment_id:
          type: string
          format: uuid
        answers:
          type: array
          items:
            type: object
            properties:
              question_id:
                type: string
                format: uuid
              answer:
                type: string

  responses:
    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
    Forbidden:
      description: Access forbidden
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
    Conflict:
      description: Resource already exists
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT